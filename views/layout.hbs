<!DOCTYPE html>
<html>
<head>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<link rel='stylesheet' href='/stylesheets/style.css' />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="/socket.io/socket.io.js"></script>
<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
  <title>{{title}}</title>
  <style>
 pre {
  overflow: auto;
  height: 100px;
  background: #fff;
  padding:3px;
  margin:3px;
  color: gray;
   width:300px; /* or whatever width you want. */
   max-width:300px; 
}	
   </style>
</head>
  <body>
    {{{body}}}
<script type="text/javascript" src="//storage.neko.pe/static/js/jquery.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120895783-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-120895783-4');
</script>

<script>
if (location.protocol !== 'https:') {
    location.replace(`https:${location.href.substring(location.protocol.length)}`);
}
  var numberOfFiles = 0;
  var ta = document.getElementById("ta");
  const copyLinkBtn= document.getElementById('cpl')
  const tocp = document.getElementById('resulturl')
  const downloadWebsite = document.getElementById('dlbtn')
  // connect to current socket.io server
  var socket = io.connect(document.URL);
  if(!localStorage['token'])
  localStorage['token']=generateToken(20);
  
  // wait for events for this token
  socket.on(localStorage['token'],(event)=>{
  console.log(event)
  document.getElementById('progress').hidden=false;
  if(event.progress=="Converting")
  {
    log.innerHTML=(`<h5>100%! Compressing your website...</h5><br>`)

  }
   else if(event.progress=="Completed")
   {
        document.getElementById('progress').hidden=true;
        log.innerHTML=(`<code>Compressing completed successfully !</code><br>`)
        downloadWebsite.style='display:'
        copyLinkBtn.style='display:'
        tocp.style='display:'
        tocp.value = `https://web.neko.pe/sites/${event.file}.zip`
        downloadWebsite.onclick=function()
        {
         window.location=`/sites/${event.file}.zip`
        }
        copyLinkBtn.onclick=function()
        {
        copy("resulturl")
        }

   }
   else
   {
        const log = document.getElementById('log');
        if(event.progress.includes('200 OK'))
        numberOfFiles++;
document.getElementById('m').hidden=false;
        
        document.getElementById('nFilesP').hidden=false;
        document.getElementById('nFiles').innerHTML=numberOfFiles 
        log.innerHTML=(`<code> ${event.progress}</code><br>`)
        logh(event.progress)
   }
  })
  
  // Download a website on click
   const downloadBtn =  document.getElementById("download");
   downloadBtn.onclick=()=>{
        var website = document.getElementById('website').value
        if(!website) return alert("Insert url first")
        console.log("Now downloading the website ... %s",website)
        socket.emit('request', { token: localStorage['token'] , website});
   }
   
  // Generate token for each user for the first time.
  function generateToken(n) {
    var chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    var token = '';
    for(var i = 0; i < n; i++) {
        token += chars[Math.floor(Math.random() * chars.length)];
    }
    return token;
}

function copy(id) {
  const element = document.querySelector('#' + id);
  element.select();
  element.setSelectionRange(0, 99999);
  document.execCommand('copy');
  return alert('Link Copied!')
}
   let messageList = document.querySelector("pre");
   function logh(message) {
   const li = document.createElement("code");
   li.innerHTML = `<small style="color:crimson">neko@site:~#</small> ${message}\n`;
   messageList.append(li);
 }
</script>
</body>
</html>
